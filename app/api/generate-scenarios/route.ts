import { generateObject } from "ai";
import { model } from "@/lib/azure";
import { z } from "zod";

export async function POST() {
  console.log("\nโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ");
  console.log("๐ฏ [GENERATE SCENARIOS] Request received");
  console.log("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ");

  try {
    const result = await generateObject({
      model,
      schema: z.object({
        scenarios: z.array(
          z.object({
            id: z.string().describe("ูุนุฑู ูุฑูุฏ ููุณููุงุฑูู"),
            title: z.string().describe("ุนููุงู ุงูุณููุงุฑูู ุจุงูุนุฑุจูุฉ"),
            category: z.enum(["sms", "whatsapp", "email"]).describe("ููุน ุงูุฑุณุงูุฉ"),
            sender: z.string().describe("ุงุณู ุงููุฑุณู ููุง ูุธูุฑ ูููุณุชุฎุฏู"),
            message: z.string().describe("ูุต ุงูุฑุณุงูุฉ ุงููุงูู"),
            answer: z.enum(["scam", "suspicious", "safe"]).describe("ุงูุชุตููู ุงูุตุญูุญ"),
            difficulty: z.enum(["easy", "medium", "hard"]).describe("ูุณุชูู ุงูุตุนูุจุฉ"),
          })
        ).describe("ูุงุฆูุฉ ุงูุณููุงุฑูููุงุช"),
      }),
      prompt: `ุฃูุช ุฎุจูุฑ ุฃูู ุณูุจุฑุงูู ุชููุณู. ุฃูุดุฆ 8 ุณููุงุฑูููุงุช ุชุฏุฑูุจูุฉ ูุชููุนุฉ ูุชุนููู ุงูููุงุทููู ุงูุชููุณููู ููููุฉ ุงูุชุดุงู ุงูุงุญุชูุงู ุงูุฑููู.

ุงููุทููุจ:
- 8 ุณููุงุฑูููุงุช ูุฎุชููุฉ ููุชููุนุฉ
- ูุฒูุฌ ูู: SMSุ WhatsAppุ Email
- ูุฒูุฌ ูู: ุงุญุชูุงู (scam)ุ ูุดุจูู (suspicious)ุ ุขูู (safe)
- ุนูู ุงูุฃูู 1-2 ุฑุณุงุฆู ุขููุฉ ุญููููุฉ ูุชุฏุฑูุจ ุงูุชูููุฒ
- ูุณุชููุงุช ุตุนูุจุฉ ูุชููุนุฉ: easyุ mediumุ hard

ุงูุณููุงุฑูููุงุช ูุฌุจ ุฃู ุชููู ูุงูุนูุฉ ููุฑุชุจุทุฉ ุจุงูุณูุงู ุงูุชููุณู:
- ูุคุณุณุงุช ุชููุณูุฉ: ุงูุจุฑูุฏ ุงูุชููุณูุ BIATุ BNAุ Attijariุ STEGุ SONEDEุ Ooredooุ Tunisie Tรฉlรฉcomุ Orange
- ููุงูู ููููุฉ: ุทุฑูุฏ ุจุฑูุฏูุฉุ ููุงุชูุฑุ ุนุฑูุถ ุนููุ ุฌูุงุฆุฒุ ุชุญูููุงุช ุจูููุฉ
- ููุฌุฉ ุชููุณูุฉ ูู ุฑุณุงุฆู WhatsApp (ุฎููุงุ ุจุฑุดุงุ ูุญุจุ ุฅูุฎ)
- ุฑูุงุจุท ูุดุจููุฉ ุจูุทุงูุงุช ุบุฑูุจุฉ (.xyzุ .tkุ .ml) ููุฑุณุงุฆู ุงูุงุญุชูุงููุฉ
- ุฑูุงุจุท ุฑุณููุฉ ุญููููุฉ ููุฑุณุงุฆู ุงูุขููุฉ

ููู ุณููุงุฑูู:
- id: ูุนุฑู ูุฑูุฏ (ูุซู "poste-2024", "biat-alert")
- title: ุนููุงู ูุตูู ุจุงูุนุฑุจูุฉ
- category: "sms" ุฃู "whatsapp" ุฃู "email"
- sender: ุงุณู ุงููุฑุณู ููุง ูุธูุฑ
- message: ูุต ุงูุฑุณุงูุฉ ุงููุงููุฉ (ูุงูุนูุฉ ูููุตูุฉ)
- answer: "scam" ุฃู "suspicious" ุฃู "safe"
- difficulty: "easy" ุฃู "medium" ุฃู "hard"

ุงุฌุนู ุงูุฑุณุงุฆู ุงูุงุญุชูุงููุฉ ูููุนุฉ ููุงูุนูุฉ ุญุชู ูุชุนูู ุงููุณุชุฎุฏู ุงูุชูููุฒ. ุงูุฑุณุงุฆู ุงูุขููุฉ ูุฌุจ ุฃู ุชุจุฏู ูุฅุดุนุงุฑุงุช ุญููููุฉ ูู ูุคุณุณุงุช ุชููุณูุฉ.`,
    });

    console.log("\nโ [GENERATE SCENARIOS] Generated", result.object.scenarios.length, "scenarios");
    console.log("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ\n");

    return Response.json(result.object);
  } catch (error) {
    console.error("\nโ [GENERATE SCENARIOS] Error:", error);
    console.log("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ\n");
    return Response.json(
      { error: "AI generation failed", details: String(error) },
      { status: 500 }
    );
  }
}
